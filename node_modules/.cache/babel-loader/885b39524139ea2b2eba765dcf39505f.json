{"ast":null,"code":"import _classCallCheck from \"C:\\\\Users\\\\Abby\\\\Desktop\\\\portfolio\\\\portfolio\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:\\\\Users\\\\Abby\\\\Desktop\\\\portfolio\\\\portfolio\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"C:\\\\Users\\\\Abby\\\\Desktop\\\\portfolio\\\\portfolio\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"C:\\\\Users\\\\Abby\\\\Desktop\\\\portfolio\\\\portfolio\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"C:\\\\Users\\\\Abby\\\\Desktop\\\\portfolio\\\\portfolio\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"C:\\\\Users\\\\Abby\\\\Desktop\\\\portfolio\\\\portfolio\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/assertThisInitialized\";\nvar _jsxFileName = \"C:\\\\Users\\\\Abby\\\\Desktop\\\\portfolio\\\\portfolio\\\\client\\\\src\\\\Components\\\\Game\\\\Game.js\";\nimport React, { Component } from 'react';\nimport { Container, Row, Col, Button } from 'reactstrap';\nimport './Game.css';\nimport Login from './Login.js';\nimport Choice from './Choice.js';\nimport Writing from './Writing.js';\nimport Voting from './Voting.js';\nimport End from './End.js';\nimport { makeStyles, withStyles } from '@material-ui/core/styles';\nimport LinearProgress from '@material-ui/core/LinearProgress';\nimport Slide from '@material-ui/lab/Slider';\nimport { FaPenFancy as Pen } from 'react-icons/fa';\n\nvar Game =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Game, _Component);\n\n  function Game(props) {\n    var _this;\n\n    _classCallCheck(this, Game);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Game).call(this, props));\n    _this.state = {\n      game: {\n        numPlayers: 0,\n        phase: -1,\n        round: 0,\n        players: [],\n        scores: [],\n        quote: [],\n        quotes: [],\n        votes: [],\n        results: false,\n        time: null,\n        submitted: [],\n        bonus: [],\n        indexOfIt: -1\n      },\n      results: {},\n      player: {\n        quote: [],\n        username: \"\",\n        index: -1\n      },\n      inGame: false\n    };\n    _this.connection = null;\n    _this.choose = _this.choose.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.vote = _this.vote.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.end = _this.end.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.reset = _this.reset.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.next = _this.next.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.setCookie = _this.setCookie.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.checkCookie = _this.checkCookie.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.updateGameBasedOnResponse = _this.updateGameBasedOnResponse.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.updateIndex = _this.updateIndex.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.writeQuote = _this.writeQuote.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.resetState = _this.resetState.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.toggleInGame = _this.toggleInGame.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    return _this;\n  }\n\n  _createClass(Game, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.connection = new WebSocket('ws://73.95.148.192:4444');\n\n      this.connection.onopen = function () {\n        console.log('Connected!');\n      }; // Log errors\n\n\n      this.connection.onerror = function (error) {\n        console.log('WebSocket Error ' + error);\n        alert(\"Cannot reach server!\");\n      }; // Log messages from the server\n\n\n      this.connection.onmessage = function (e) {\n        // console.log('Server: ' + e.data);\n        var broadcast = JSON.parse(e.data);\n        if (!broadcast['players'].includes(this.state.player.username)) this.state.inGame = false;\n        var keys = Object.keys(broadcast);\n        if (broadcast['end']) this.resetState();else {\n          for (var i = 0; i < keys.length; i++) {\n            if (this.state.game.phase !== 1 && keys[i] === 'quote') continue;\n            this.updateGameBasedOnResponse(keys[i], broadcast[keys[i]]);\n          }\n        }\n        this.render();\n      }.bind(this);\n\n      this.connection.onclose = function (e) {\n        console.log('Connection lost'); //THIS FUNCTION IS CALLED ON REFRESH IN FIREFOX BUT NOT CHROME\n        // DELETING COOKIES BREAKS FUNCTIONALITY IN FIREFOX\n        // document.cookie = \"username=;expires=Wed, 14 Jun 2017 07:00:00 GMT;path=/\";\n        // document.cookie = \"index=;expires=Wed, 14 Jun 2017 07:00:00 GMT;path=/\";\n      };\n\n      this.checkCookie();\n    }\n  }, {\n    key: \"updateGameBasedOnResponse\",\n    value: function updateGameBasedOnResponse(key, value) {\n      var state = this.state;\n      var item = 'game';\n\n      if (key === 'username') {\n        this.setCookie(value, 365);\n        item = 'player';\n      }\n\n      state[item][key] = value;\n      this.setState(state);\n      this.updateIndex();\n    }\n  }, {\n    key: \"updateIndex\",\n    value: function updateIndex() {\n      var state = this.state;\n      state.player.index = this.state.game.players.indexOf(this.state.player.username);\n      this.setState(state);\n    }\n  }, {\n    key: \"writeQuote\",\n    value: function writeQuote(quote) {\n      var state = this.state;\n      state.player.quote = state.game.quote;\n      state.player.quote[2] = quote;\n      this.setState(state);\n    }\n  }, {\n    key: \"resetState\",\n    value: function resetState() {\n      var state = {\n        game: {\n          numPlayers: 0,\n          phase: -1,\n          players: [],\n          scores: [],\n          quote: [],\n          quotes: [],\n          time: null,\n          indexOfIt: -1\n        },\n        player: {\n          quote: [],\n          username: \"\",\n          index: -1\n        },\n        inGame: false\n      };\n      this.setState(state);\n    }\n  }, {\n    key: \"toggleInGame\",\n    value: function toggleInGame() {\n      this.setState({\n        inGame: !this.state.inGame\n      });\n    }\n  }, {\n    key: \"setCookie\",\n    value: function setCookie(username) {\n      var exdays = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n      var d = new Date();\n      d.setTime(d.getTime() + exdays * 24 * 60 * 60 * 1000);\n      var expires = exdays === 0 ? \"\" : \"expires=\" + d.toUTCString() + \";path=/\";\n      document.cookie = \"username=\" + username + \";\" + expires; // document.cookie = \"index=\" + index + \";\" + expires;\n    }\n  }, {\n    key: \"getCookie\",\n    value: function getCookie(cname) {\n      var name = cname + \"=\";\n      var ca = document.cookie.split(';');\n\n      for (var i = 0; i < ca.length; i++) {\n        var c = ca[i];\n\n        while (c.charAt(0) === ' ') {\n          c = c.substring(1);\n        }\n\n        if (c.indexOf(name) === 0) {\n          return c.substring(name.length, c.length);\n        }\n      }\n\n      return \"\";\n    }\n  }, {\n    key: \"checkCookie\",\n    value: function checkCookie() {\n      var user = this.getCookie(\"username\");\n      var index = Number(this.getCookie(\"index\"));\n\n      if (user !== \"\") {\n        var player = this.state.player;\n        player.username = user;\n        player.index = index;\n        this.setState(player);\n        this.setState({\n          inGame: true\n        });\n      }\n    }\n  }, {\n    key: \"choose\",\n    value: function choose(quote) {\n      quote[3] = this.state.player.index;\n      var request = {\n        'type': 'request',\n        'action': 'choose',\n        'quote': quote,\n        'name': this.state.player.username,\n        'index': this.state.player.index\n      };\n      this.connection.send(JSON.stringify(request));\n    }\n  }, {\n    key: \"vote\",\n    value: function vote(index) {\n      var bonusPoints = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      var request = {\n        'type': 'request',\n        'action': bonusPoints ? 'bonus' : 'vote',\n        'voteIndex': index,\n        'name': this.state.player.username,\n        'index': this.state.player.index\n      };\n      this.connection.send(JSON.stringify(request));\n    }\n  }, {\n    key: \"end\",\n    value: function end() {\n      var request = {\n        'type': 'request',\n        'action': 'end',\n        'name': this.state.player.username,\n        'index': this.state.player.index\n      };\n      this.connection.send(JSON.stringify(request));\n    }\n  }, {\n    key: \"next\",\n    value: function next() {\n      var request = {\n        'type': 'request',\n        'action': 'next',\n        'name': this.state.player.username,\n        'index': this.state.player.index\n      };\n      this.connection.send(JSON.stringify(request));\n    }\n  }, {\n    key: \"reset\",\n    value: function reset() {\n      this.resetState();\n      this.setCookie(\"\", \"\", -1);\n      console.log(\"The game is ending.\");\n      var request = {\n        'type': 'request',\n        'action': 'reset',\n        'name': this.state.player.username,\n        'index': this.state.player.index\n      };\n      this.connection.send(JSON.stringify(request));\n    }\n  }, {\n    key: \"displayScores\",\n    value: function displayScores() {\n      var data = [];\n\n      for (var i = 0; i < this.state.game.scores.length; i++) {\n        data.push(React.createElement(Col, {\n          key: this.state.game.players[i] + \"_\" + i,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 239\n          },\n          __self: this\n        }, this.state.game.players[i] + \": \" + this.state.game.scores[i]));\n      }\n\n      return React.createElement(Container, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 242\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"username curved\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 243\n        },\n        __self: this\n      }, data));\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var page = this.state.inGame && !this.state.game.players.includes(this.state.player.username) ? React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 253\n        },\n        __self: this\n      }, \"Hi\") : this.state.game.phase === -1 ? React.createElement(Login, {\n        updateGameBasedOnResponse: this.updateGameBasedOnResponse,\n        player: this.state.player,\n        game: this.state.game,\n        inGame: this.state.inGame,\n        toggleInGame: this.toggleInGame,\n        setCookie: this.setCookie,\n        connection: this.connection,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 256\n        },\n        __self: this\n      }) : this.state.game.phase === 0 && this.state.inGame ? React.createElement(Choice, {\n        choose: this.choose,\n        updateGameBasedOnResponse: this.updateGameBasedOnResponse,\n        player: this.state.player,\n        game: this.state.game,\n        quoteChoices: this.state.quoteChoices,\n        connection: this.connection,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 266\n        },\n        __self: this\n      }) : this.state.game.phase === 1 && this.state.inGame ? React.createElement(Writing, {\n        updateGameBasedOnResponse: this.updateGameBasedOnResponse,\n        player: this.state.player,\n        choose: this.choose,\n        writeQuote: this.writeQuote,\n        game: this.state.game,\n        connection: this.connection,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 275\n        },\n        __self: this\n      }) : this.state.game.phase === 2 && this.state.inGame ? React.createElement(Voting, {\n        vote: this.vote,\n        updateGameBasedOnResponse: this.updateGameBasedOnResponse,\n        player: this.state.player,\n        game: this.state.game,\n        connection: this.connection,\n        next: this.next,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 284\n        },\n        __self: this\n      }) : this.state.game.phase === 3 && this.state.inGame ? React.createElement(End, {\n        player: this.state.player,\n        game: this.state.game,\n        connection: this.connection,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 293\n        },\n        __self: this\n      }) : React.createElement(\"div\", {\n        className: \"waiting\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 298\n        },\n        __self: this\n      }, \"Please wait for the current game to finish!\");\n      var ColorLinearProgress = withStyles({\n        root: {\n          height: 8\n        },\n        colorPrimary: {\n          backgroundColor: '#232323'\n        },\n        barColorPrimary: {\n          backgroundColor: '#0accab'\n        }\n      })(LinearProgress);\n      var rounds = [];\n\n      for (var i = 1; i <= this.state.game.rounds; i++) {\n        rounds.push(React.createElement(\"div\", {\n          key: \"round_\" + i,\n          className: i == this.state.game.round ? \"round current\" : \"round\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 315\n          },\n          __self: this\n        }, i));\n      }\n\n      return React.createElement(\"div\", {\n        className: \"game\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 319\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"title\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 320\n        },\n        __self: this\n      }, React.createElement(Row, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 321\n        },\n        __self: this\n      }, React.createElement(Col, {\n        sm: \"3\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 322\n        },\n        __self: this\n      }), React.createElement(Col, {\n        sm: \"6\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 324\n        },\n        __self: this\n      }, React.createElement(Pen, {\n        className: \"icon\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 325\n        },\n        __self: this\n      }), \" Wordsmyth\"), React.createElement(Col, {\n        sm: \"3\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 327\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"round\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 328\n        },\n        __self: this\n      }, this.state.game.phase !== -1 || this.state.game.phase !== 3 ? rounds : \"\")))), React.createElement(\"div\", {\n        className: \"username\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 334\n        },\n        __self: this\n      }, this.state.game.phase !== -1 ? this.state.player.username : React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 335\n        },\n        __self: this\n      })), React.createElement(ColorLinearProgress, {\n        className: \"timer\",\n        variant: \"determinate\",\n        value: this.state.inGame && this.state.game.phase != 3 ? 100 * this.state.game.time / 60 : 100,\n        barColorPrimary: \"#0accab\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 337\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 338\n        },\n        __self: this\n      }, page, this.state.game.results && this.state.player.index == 0 ? React.createElement(Button, {\n        className: \"shadow\",\n        style: {\n          display: 'block',\n          marginTop: '0px',\n          marginBottom: '20px',\n          marginRight: 'auto',\n          marginLeft: 'auto',\n          borderRadiusBottom: '40px'\n        },\n        onClick: this.next,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 341\n        },\n        __self: this\n      }, \"Next Round\") : \"\", this.state.inGame ? this.displayScores() : \"\", this.state.game.phase !== -1 && this.state.inGame ? React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 350\n        },\n        __self: this\n      }, React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 351\n        },\n        __self: this\n      }), React.createElement(Button, {\n        className: \"shadow\",\n        style: {\n          marginLeft: '35px',\n          marginBottom: '20px',\n          borderRadius: '40px'\n        },\n        onClick: this.state.game.phase === 3 ? this.reset : this.end,\n        disabled: this.state.game.phase === -1,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 353\n        },\n        __self: this\n      }, this.state.game.phase === 3 ? \"Play Again!\" : \"End Game\")) : \"\"));\n    }\n  }]);\n\n  return Game;\n}(Component);\n\nexport default Game;","map":{"version":3,"sources":["C:\\Users\\Abby\\Desktop\\portfolio\\portfolio\\client\\src\\Components\\Game\\Game.js"],"names":["React","Component","Container","Row","Col","Button","Login","Choice","Writing","Voting","End","makeStyles","withStyles","LinearProgress","Slide","FaPenFancy","Pen","Game","props","state","game","numPlayers","phase","round","players","scores","quote","quotes","votes","results","time","submitted","bonus","indexOfIt","player","username","index","inGame","connection","choose","bind","vote","end","reset","next","setCookie","checkCookie","updateGameBasedOnResponse","updateIndex","writeQuote","resetState","toggleInGame","WebSocket","onopen","console","log","onerror","error","alert","onmessage","e","broadcast","JSON","parse","data","includes","keys","Object","i","length","render","onclose","key","value","item","setState","indexOf","exdays","d","Date","setTime","getTime","expires","toUTCString","document","cookie","cname","name","ca","split","c","charAt","substring","user","getCookie","Number","request","send","stringify","bonusPoints","push","page","quoteChoices","ColorLinearProgress","root","height","colorPrimary","backgroundColor","barColorPrimary","rounds","display","marginTop","marginBottom","marginRight","marginLeft","borderRadiusBottom","displayScores","borderRadius"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport { Container, Row, Col, Button } from 'reactstrap';\r\n\r\nimport './Game.css'\r\nimport Login from './Login.js'\r\nimport Choice from './Choice.js'\r\nimport Writing from './Writing.js'\r\nimport Voting from './Voting.js'\r\nimport End from './End.js'\r\n\r\nimport { makeStyles, withStyles } from '@material-ui/core/styles';\r\nimport LinearProgress from '@material-ui/core/LinearProgress';\r\nimport Slide from '@material-ui/lab/Slider';\r\n\r\n\r\n\r\nimport { FaPenFancy as Pen } from 'react-icons/fa'\r\n\r\n\r\nclass Game extends Component {\r\n  constructor(props){\r\n    super(props);\r\n    this.state = {\r\n      game: {\r\n        numPlayers: 0,\r\n        phase: -1,\r\n        round: 0,\r\n        players: [],\r\n        scores: [],\r\n        quote: [],\r\n        quotes: [],\r\n        votes: [],\r\n        results: false,\r\n        time: null,\r\n        submitted: [],\r\n        bonus: [],\r\n        indexOfIt: -1\r\n      },\r\n      results: {\r\n        \r\n      },\r\n      player: {\r\n        quote: [],\r\n        username: \"\",\r\n        index: -1\r\n      },\r\n      inGame: false\r\n    };\r\n    this.connection = null;\r\n    this.choose = this.choose.bind(this)\r\n    this.vote = this.vote.bind(this)\r\n    this.end = this.end.bind(this)\r\n    this.reset = this.reset.bind(this)\r\n    this.next = this.next.bind(this)\r\n    this.setCookie = this.setCookie.bind(this);\r\n    this.checkCookie = this.checkCookie.bind(this);\r\n    this.updateGameBasedOnResponse = this.updateGameBasedOnResponse.bind(this);\r\n    this.updateIndex = this.updateIndex.bind(this);\r\n    this.writeQuote = this.writeQuote.bind(this);\r\n    this.resetState = this.resetState.bind(this);\r\n    this.toggleInGame = this.toggleInGame.bind(this);\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.connection = new WebSocket('ws://73.95.148.192:4444');\r\n    this.connection.onopen = function () {\r\n      console.log('Connected!');\r\n    };\r\n\r\n    // Log errors\r\n    this.connection.onerror = function (error) {\r\n      console.log('WebSocket Error ' + error);\r\n      alert(\"Cannot reach server!\")\r\n    };\r\n\r\n    // Log messages from the server\r\n    this.connection.onmessage = function (e) {\r\n      // console.log('Server: ' + e.data);\r\n      let broadcast = JSON.parse(e.data);\r\n      if(!broadcast['players'].includes(this.state.player.username)) this.state.inGame = false;\r\n      let keys = Object.keys(broadcast);\r\n      if (broadcast['end']) this.resetState();\r\n      else {\r\n        for(let i = 0; i<keys.length; i++) {\r\n          if(this.state.game.phase !== 1 && keys[i]==='quote') continue;\r\n          this.updateGameBasedOnResponse(keys[i], broadcast[keys[i]])\r\n        }\r\n      }\r\n      this.render();\r\n    }.bind(this);\r\n\r\n    this.connection.onclose = function (e) {\r\n      console.log('Connection lost');\r\n      //THIS FUNCTION IS CALLED ON REFRESH IN FIREFOX BUT NOT CHROME\r\n      // DELETING COOKIES BREAKS FUNCTIONALITY IN FIREFOX\r\n      // document.cookie = \"username=;expires=Wed, 14 Jun 2017 07:00:00 GMT;path=/\";\r\n      // document.cookie = \"index=;expires=Wed, 14 Jun 2017 07:00:00 GMT;path=/\";\r\n    };\r\n    this.checkCookie();\r\n  }\r\n\r\n  updateGameBasedOnResponse(key, value) {\r\n    let state = this.state;\r\n    let item = 'game'\r\n    if(key === 'username') {\r\n      this.setCookie(value, 365);\r\n      item = 'player';\r\n    }\r\n    state[item][key] = value;\r\n    this.setState(state);\r\n    this.updateIndex();\r\n  }\r\n\r\n  updateIndex(){\r\n    let state = this.state;\r\n    state.player.index = this.state.game.players.indexOf(this.state.player.username);\r\n    this.setState(state);\r\n  }\r\n\r\n  writeQuote(quote) {\r\n    let state = this.state;\r\n    state.player.quote=state.game.quote;\r\n    state.player.quote[2]=quote;\r\n    this.setState(state);\r\n  }\r\n  resetState() {\r\n    let state = {\r\n      game: {\r\n        numPlayers: 0,\r\n        phase: -1,\r\n        players: [],\r\n        scores: [],\r\n        quote: [],\r\n        quotes: [],\r\n        time: null,\r\n        indexOfIt: -1\r\n      },\r\n      player: {\r\n        quote: [],\r\n        username: \"\",\r\n        index: -1\r\n      },\r\n      inGame: false\r\n    };\r\n    this.setState(state);\r\n  }\r\n\r\n  toggleInGame() {\r\n    this.setState({inGame: !this.state.inGame})\r\n\r\n  }\r\n  setCookie(username, exdays=0) {\r\n    var d = new Date();\r\n    d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));\r\n    var expires = (exdays===0) ? \"\" : \"expires=\"+d.toUTCString() + \";path=/\";\r\n    document.cookie = \"username=\" + username + \";\" + expires;\r\n    // document.cookie = \"index=\" + index + \";\" + expires;\r\n  }\r\n  getCookie(cname) {\r\n    let name = cname + \"=\";\r\n    let ca = document.cookie.split(';');\r\n    for(let i = 0; i < ca.length; i++) {\r\n      let c = ca[i];\r\n      while (c.charAt(0) === ' ') {\r\n        c = c.substring(1);\r\n      }\r\n      if (c.indexOf(name) === 0) {\r\n        return c.substring(name.length, c.length);\r\n      }\r\n    }\r\n    return \"\";\r\n  }\r\n  checkCookie() {\r\n    let user = this.getCookie(\"username\");\r\n    let index = Number(this.getCookie(\"index\"));\r\n    if (user !== \"\") {\r\n      let player = this.state.player;\r\n      player.username = user;\r\n      player.index = index;\r\n      this.setState(player);\r\n      this.setState({inGame: true});\r\n    }\r\n  }\r\n  choose(quote){\r\n    quote[3] = this.state.player.index;\r\n    let request = {\r\n      'type': 'request',\r\n      'action': 'choose',\r\n      'quote': quote,\r\n      'name': this.state.player.username,\r\n      'index': this.state.player.index\r\n    };\r\n    this.connection.send(JSON.stringify(request));\r\n  }\r\n  vote(index, bonusPoints=false){\r\n    let request = {\r\n      'type': 'request',\r\n      'action': bonusPoints ? 'bonus' : 'vote',\r\n      'voteIndex': index,\r\n      'name': this.state.player.username,\r\n      'index': this.state.player.index\r\n    };\r\n    this.connection.send(JSON.stringify(request));\r\n    \r\n  }\r\n  end(){\r\n    let request = {\r\n      'type': 'request',\r\n      'action': 'end',\r\n      'name': this.state.player.username,\r\n      'index': this.state.player.index\r\n    };\r\n    this.connection.send(JSON.stringify(request));\r\n  }\r\n  next(){\r\n    let request = {\r\n      'type': 'request',\r\n      'action': 'next',\r\n      'name': this.state.player.username,\r\n      'index': this.state.player.index\r\n    };\r\n    this.connection.send(JSON.stringify(request));\r\n  }\r\n  reset(){\r\n    this.resetState();\r\n    this.setCookie(\"\", \"\", -1);\r\n    console.log(\"The game is ending.\");\r\n    let request = {\r\n      'type': 'request',\r\n      'action': 'reset',\r\n      'name': this.state.player.username,\r\n      'index': this.state.player.index\r\n    };\r\n    this.connection.send(JSON.stringify(request));\r\n  }\r\n  displayScores(){\r\n    let data = [];\r\n    for (let i = 0; i<this.state.game.scores.length; i++) {\r\n      data.push(<Col key={this.state.game.players[i]+\"_\"+i}>{this.state.game.players[i] +\": \" + this.state.game.scores[i]}</Col>)\r\n    }\r\n    return(\r\n      <Container>\r\n      <div className=\"username curved\">\r\n        {data}\r\n      </div>\r\n      </Container>\r\n    )\r\n  }\r\n  \r\n  render() {\r\n    const page = \r\n      this.state.inGame && !this.state.game.players.includes(this.state.player.username) ?\r\n      <div>Hi</div>\r\n      :   \r\n      this.state.game.phase === -1 ? \r\n        <Login  \r\n          updateGameBasedOnResponse={this.updateGameBasedOnResponse}\r\n          player={this.state.player}\r\n          game={this.state.game}\r\n          inGame={this.state.inGame}\r\n          toggleInGame={this.toggleInGame}\r\n          setCookie={this.setCookie}\r\n          connection={this.connection}\r\n        /> :\r\n        this.state.game.phase === 0 && this.state.inGame ? \r\n        <Choice\r\n          choose={this.choose}\r\n          updateGameBasedOnResponse={this.updateGameBasedOnResponse}\r\n          player={this.state.player}\r\n          game={this.state.game}\r\n          quoteChoices={this.state.quoteChoices}\r\n          connection={this.connection}\r\n        /> :\r\n        this.state.game.phase === 1 && this.state.inGame ? \r\n        <Writing\r\n          updateGameBasedOnResponse={this.updateGameBasedOnResponse}\r\n          player={this.state.player}\r\n          choose={this.choose}\r\n          writeQuote={this.writeQuote}\r\n          game={this.state.game}\r\n          connection={this.connection}\r\n        /> :\r\n        this.state.game.phase === 2 && this.state.inGame ? \r\n        <Voting\r\n          vote={this.vote}\r\n          updateGameBasedOnResponse={this.updateGameBasedOnResponse}\r\n          player={this.state.player}\r\n          game={this.state.game}\r\n          connection={this.connection}\r\n          next={this.next}\r\n        /> :\r\n        this.state.game.phase === 3 && this.state.inGame ? \r\n        <End\r\n          player={this.state.player}\r\n          game={this.state.game}\r\n          connection={this.connection}\r\n        />\r\n      : <div className=\"waiting\">Please wait for the current game to finish!</div>;\r\n\r\n    const ColorLinearProgress = withStyles({\r\n      root: {\r\n        height: 8\r\n      },\r\n      colorPrimary: {\r\n        backgroundColor: '#232323',\r\n      },\r\n      barColorPrimary: {\r\n        backgroundColor: '#0accab',\r\n      },\r\n    })(LinearProgress);\r\n\r\n    let rounds = []\r\n\r\n    for(let i = 1; i<=this.state.game.rounds; i++){\r\n      rounds.push(<div key={\"round_\"+i} className={(i==this.state.game.round) ? \"round current\" : \"round\"}>{i}</div>)\r\n    }\r\n\r\n    return (\r\n      <div className=\"game\">\r\n        <div className=\"title\">\r\n        <Row>\r\n          <Col sm=\"3\"></Col>\r\n          \r\n          <Col sm=\"6\">\r\n            <Pen className=\"icon\"/> Wordsmyth\r\n          </Col>\r\n          <Col sm=\"3\">\r\n            <div className=\"round\">\r\n              {this.state.game.phase!==-1 || this.state.game.phase!==3 ? rounds : \"\"}\r\n            </div>\r\n          </Col>\r\n        </Row>\r\n        </div>\r\n        <div className=\"username\">\r\n          {(this.state.game.phase !==-1) ? this.state.player.username : <br/>}\r\n        </div>\r\n        <ColorLinearProgress className=\"timer\" variant=\"determinate\" value={this.state.inGame && this.state.game.phase !=3 ? 100*this.state.game.time/60 : 100} barColorPrimary='#0accab'/>\r\n        <div>      \r\n          {page}\r\n          {(this.state.game.results && this.state.player.index==0) ? \r\n            <Button \r\n              className=\"shadow\"\r\n              style={{display:'block', marginTop: '0px', marginBottom: '20px' ,marginRight:'auto', marginLeft:'auto',borderRadiusBottom:'40px'}}\r\n              onClick={this.next}>\r\n                Next Round\r\n            </Button> \r\n            : \"\"}\r\n          {this.state.inGame ? this.displayScores() : \"\"}  \r\n          {(this.state.game.phase !==-1 && this.state.inGame) ?\r\n          <div>\r\n            <br/>\r\n            \r\n            <Button\r\n              className=\"shadow\"\r\n              style={{marginLeft: '35px', marginBottom: '20px', borderRadius:'40px'}}\r\n              onClick={this.state.game.phase === 3 ? this.reset : this.end}\r\n              disabled={this.state.game.phase === -1}\r\n            >\r\n              {this.state.game.phase === 3 ? \"Play Again!\" : \"End Game\"}\r\n            </Button>\r\n          </div>\r\n          :\r\n          \"\"}  \r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\nexport default Game;"]},"metadata":{},"sourceType":"module"}